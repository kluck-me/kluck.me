var PriorityQueue,Puzzle,finder,pp,time,slice=[].slice;pp=function(){var t;t=1<=arguments.length?slice.call(arguments,0):[],self.postMessage({type:"debug",value:t})},time=function(t){var e;return e=Date.now(),t(),Date.now()-e},PriorityQueue=function(){function t(){this.data=[]}return t.prototype.push=function(t){this.data.push(t),this._up(this.data.length-1)},t.prototype.pop=function(){var t;if(this.data.length)return t=this.data[0],this.data.length-1>0&&(this.data[0]=this.data[this.data.length-1],this._down(0)),this.data.pop(),t},t.prototype._up=function(t){var e,a,i;for(a=this.data[t];t>0&&(i=t-1>>1,e=this.data[i],!(a.compareTo(e)>=0));)this.data[t]=e,t=i;this.data[t]=a},t.prototype._down=function(t){var e,a,i,n,s;for(i=this.data[t],a=this.data.length>>1;t<a&&(n=1+(t<<1),s=n+1,e=this.data[n],s<this.data.length&&this.data[s].compareTo(e)<0&&(n=s,e=this.data[s]),!(e.compareTo(i)>=0));)this.data[t]=e,t=n;this.data[t]=i},t}(),Puzzle=function(){function t(){}return t.MOVES=[{x:0,y:-1,path:"u"},{x:1,y:0,path:"r"},{x:0,y:1,path:"d"},{x:-1,y:0,path:"l"}],t.validateBoard=function(t){var e;if(!Array.isArray(t))throw new Error("board is broken");if(!t.length)throw new Error("board is broken");if(!(e=t[0].length))throw new Error("board is broken");if(!t.every(function(t){return t.length===e&&t.every(function(t){return"number"==typeof t})}))throw new Error("board should be two-dimensional array")},t.prototype.clone=function(){var e,a,i;a=new t;for(e in this)i=this[e],this.hasOwnProperty(e)&&(a[e]=i&&"object"==typeof i?i.concat():i);return a},t.prototype.setBoard=function(e){var a,i,n,s,h,r,o;for(t.validateBoard(e),this.height=e.length,this.width=e[0].length,this.panel=[],this.space=-1,this.path="",a=0,o=i=0,s=this.height;i<s;o=i+=1)for(r=n=0,h=this.width;n<h;r=n+=1)0===e[o][r]?(this.panel[a]=this.height*this.width,this.space=a):this.panel[a]=e[o][r],a+=1;if(-1===this.space)throw new Error("space not found");if(!this.panel.concat().sort(function(t,e){return t-e}).every(function(t,e){return t===e+1}))throw new Error("panel is broken");this.setCalculatedDistance()},t.prototype.calcManhattanDistance=function(t,e){var a,i,n,s;return a=t%this.width,n=t/this.width|0,i=e%this.width,s=e/this.width|0,Math.abs(a-i)+Math.abs(n-s)},t.prototype.setCalculatedDistance=function(){var t,e,a;for(this.distance=0,t=e=0,a=this.panel.length;e<a;t=e+=1)t!==this.space&&(this.distance+=this.calcManhattanDistance(t,this.panel[t]-1));this.estimate=this.distance,this.cost=0},t.prototype.moveSpace=function(t,e){var a;a=t+e*this.width,this.distance+=this.calcManhattanDistance(this.space,this.panel[a]-1),this.distance-=this.calcManhattanDistance(a,this.panel[a]-1),this.panel[this.space]=this.panel[a],this.panel[a]=this.height*this.width,this.space=a},t.prototype.compareTo=function(t){return this.estimate-t.estimate},t.prototype.toString=function(){return this.panel.join(",")},t}(),finder=function(t){var e,a,i,n,s,h,r,o,p,c,d,u;for(e={},p=new PriorityQueue,(r=new Puzzle).setBoard(t),r.estimate=r.distance,p.push(r);p.data.length;){if(0===(r=p.pop()).distance)return r.path;for(e[r]=!0,d=r.space%r.width,u=r.space/r.width|0,a=0,i=(c=Puzzle.MOVES).length;a<i;a++)s=d+(n=c[a]).x,h=u+n.y,s<0||r.width<=s||h<0||r.height<=h||((o=r.clone()).moveSpace(s,h),e[o]||(o.cost+=1,o.estimate=o.distance+o.cost,o.path+=n.path,p.push(o)))}return null},"undefined"!=typeof self?self.addEventListener("message",function(t){pp(time(function(){try{self.postMessage({type:"result",value:finder(t.data.board)})}catch(e){t=e,self.postMessage({type:"error",value:t.message})}}))},!1):(pp=console.log.bind(console))(time(function(){pp(finder([[1,7,2,4],[6,0,14,3],[13,10,11,8],[5,9,15,12]]))}));