<!DOCTYPE html><html lang="ja"><head><meta charset="UTF-8"><title>percentage</title><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous"></head><body><div class="container"><div class="row"><div class="col-xs-12"><p><input id="input" value="1,4,1,1"></p><dl><dt>values</dt><dd id="values"></dd><dt>twitter emulation</dt><dd id="twper"></dd><dt>proposed algorithm</dt><dd id="myper"></dd></dl></div></div></div><script src="//code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script><script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><script>window.pp=console.log.bind(console);</script><script>function sum(a) { return a.reduce(function(x, y) { return x + y; }); }
      function outper(a) { return a.map(function (p) { return p + '%'; }).join(', '); }
      function twper(values) {
        var total = sum(values);
        var twper = values.map(function (v) { return Math.round(v / total * 100); });
        for (var i = twper.length - 1; i >= 0; --i) {
          if (twper[i] > 0) {
            twper[i] += (100 - sum(twper));
            break;
          }
        }
        return twper;
      }
      function myper(values) {
        var obj = {};
        values.forEach(function (v) { obj[v] = ++obj[v] || 1; });
        var arr = [];
        for (var k in obj) if (obj[k]) arr.push([ k, obj[k] ]);
        arr.sort(function (a, b) { return b[1] - a[1]; });
        var total = sum(values);
        var sum_per = 0;
        var res = {};
        arr.forEach(function (a) {
          var v = a[0];
          var p = Math.round(v / total * 100);
          res[v] = p;
          sum_per += p * a[1];
        });
        res[arr[arr.length - 1][0]] += (100 - sum_per);
        return values.map(function (v) {
          return res[v] || 0;
        });
      }
      $('#input').on('input', function () {
        var values = $(this).val().split(',').map(function (v) { return parseInt(v, 10) || 0; });
        $('#values').text(values.join(', '));
        $('#twper').text(outper(twper(values)));
        $('#myper').text(outper(myper(values)));
      }).trigger('input');</script></body></html>