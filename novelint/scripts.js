var Novelint,novelint,pp;pp=console.log.bind(console),Novelint=function(){function t(){this.checkers={},this.results=[],this.count=0}return t.match=function(t,e,n){return function(i){var o,r,h,a;for(a=[];h=e.exec(i);)(!n||n(h))&&(o=h.index,r=0,h[2]?(o+=h[1].length,r=h[2].length):h[1]&&(r=h[1].length),a.push([t,o,o+r]));return a}},t.prototype.add=function(t,e){var n;((n=this.checkers)[t]||(n[t]=[])).push(e)},t.prototype.addMatch=function(e,n,i,o){this.add(e,t.match(n,i,o))},t.prototype.check=function(t,e){var n,i,o,r,h,a,c,l,s,u;this.text=t.replace(/\r\n?/g,"\n"),s=[];for(a in this.checkers)if(e[a])for(l=this.checkers[a],i=0,r=l.length;r>i;i++)n=l[i],s=s.concat(n.call(this,this.text));for(c=[],o=0,h=s.length;h>o;o++)u=s[o],c.push([u[0],u[1],u[1]],["end",u[1],u[2]]);return c.sort(function(t,e){return t[2]-e[2]||e[1]-t[1]||("end"===t[0]?1:"end"===e[0]?-1:0)}),this.count=s.length,this.results=c,this},t.prototype.html=function(){var t,e,n,i,o,r;for(r=[],t=0,o=this.results,e=0,n=o.length;n>e;e++)i=o[e],t!==i[2]&&(r.push(this.text.slice(t,i[2])),t=i[2]),"end"===i[0]?r.push("</span>"):r.push('<span class="bg-'+i[0]+'" data-toggle="tooltip" title="エラー">&shy;');return t!==this.text.length&&r.push(this.text.slice(t)),r.join("")},t}(),novelint=new Novelint,novelint.addMatch("indent","danger",/^[^　「『（]/gm,function(t){return"\n"!==t.input.slice(t.index,t.index+1)}),novelint.addMatch("mark-before-close-quote","danger",/([、。])[）』」]/gm),novelint.addMatch("space-after-mark","danger",/([！？])[^　！？）』」]/gm),novelint.addMatch("double-mark","danger",/(\u2014+|\u2026+)/gm,function(t){return 2!==t[1].length}),novelint.addMatch("single-mark","danger",/([、。]{2,})/gm),novelint.addMatch("halfwidth-char","warning",/([ -~]+)/gm),novelint.addMatch("fullwidth-char","warning",/([０-９Ａ-Ｚａ-ｚ]+)/gm),novelint.addMatch("extra-space","warning",/(　+)$/gm),novelint.addMatch("extra-space","warning",/([^！？])(　+)/gm),$(function(t){var e,n;e=-1,t("#checker").submit(function(){var n;return n={},t(this).find('input[type="checkbox"]').each(function(){n[this.name]=this.checked}),novelint.check(this.text.value,n),t("h2").text(t("h2").text().replace(/\d+/,novelint.count)),t("#result").html(novelint.html()),t('#result [data-toggle="tooltip"]').tooltip(),e=-1,t(".hide").removeClass("hide"),!1}),t("#prev-error").click(function(){var i;return i=t('#result [data-toggle="tooltip"]'),0>=e&&(e=i.length),e--,n(i,e),!1}),t("#next-error").click(function(){var i;return i=t('#result [data-toggle="tooltip"]'),e>=i.length-1&&(e=-1),e++,n(i,e),!1}),n=function(e,n){e.tooltip("hide"),setTimeout(function(){return e.eq(n).tooltip("show")},10),t("html,body").animate({scrollTop:e.eq(n).offset().top-window.innerHeight/2})},t("#checker").find('[name="text"]').val("　あ　あ。は？　と？　").end().submit()});