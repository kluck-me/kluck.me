var slice=[].slice;!function(e){var n,t,a,i,s,r,o,p,u,l;l=function(){var e,n,t,a,i,s,r,o,p,u,l,c;l={"ん":["ｎ"]},n={"ｋ":"かきくけこ","ｇ":"がぎぐげご","ｓ":"さしすせそ","ｚ":"ざじずぜぞ","ｔ":"たちつてと","ｄ":"だぢづでど","ｎ":"なにぬねの","ｈ":"はひふへほ","ｂ":"ばびぶべぼ","ｐ":"ぱぴぷぺぽ","ｍ":"まみむめも","ｙ":"やゆよ","ｒ":"らりるれろ","ｗ":"わを"},c=["ゃ","ゅ","ょ"];for(i in n){for(r=0,o=(e=n[i].split("")).length;r<o;r++)l[s=e[r]]=[i,s];if(5===e.length)for(t=e[1],u=0,p=c.length;u<p;u++)l[a=""+t+c[u]]="じ"===t?["ｊ",a]:[i,i+"ｙ",a]}return l}(),u=function(e){var n,t,a,i,s,r,o,p,u,c,f;for(f=[],s="",n=i=0,r=(c=e.match(/.[ゃゅょ]|./g)).length;i<r;n=++i){for(p=0,o=(a="っ"===(u=c[n])&&l[c[n+1]]?[l[c[n+1]][0]]:l[u]||[u]).length;p<o;p++)t=a[p],f.push(""+s+t);s+=u}return f[f.length-1]!==s&&f.push(s),f},a=function(e,n,t){return function(){n&&setTimeout(function(){n.call(t||this)},e||0)}},n=function(n,t){var a,i;return i=n[t+"TagName"],a=n[t+"ClassName"],e("<"+i+">").addClass(a)},p=function(e,t,i,s,r,o){var p,l;p=n(i,"input").addClass(i[e+"ClassName"]).appendTo(s),(l=function(e){var n,s,c,f,d,g,m,v,h,y,C,N;if(t[e]){for(d=t[e-1]||"",s=t[e],h="",c=f=0,g=s.length;f<g&&(n=s[c])===d[c];c=++f)h+=n;if(C=u(s.slice(h.length)).map(function(e){return h+e}),d)for(v=m=h.length,y=d.length;m<=y;v=m+=1)C.unshift(d.slice(0,v));N=function(n){p.text(C[n]),r&&r(),C[n+1]?a(i.typeSpeed,function(){N(n+1)})():l(e+1)},a(i.typeStartSpeed,function(){N(0)})()}else o&&o()})(0)},o=function(e,t,i,s,r){var o,p,u,l,c;for(i.empty(),u=0,l=e.length;u<l;u++)p=e[u],n(t,"input").text(p[0]).appendTo(i);(o=i.find(">."+t.inputClassName)).addClass(t.typingClassName),o.eq(0).addClass(t.convertClassName),s&&s(),c=function(n,i){var p,u,l;if(e[n][i])return o.removeClass(t.convertClassName),o.eq(n).addClass(t.convertClassName).text(e[n][i]),s&&s(),void a(t.convertSpeed,function(){c(n,i+1)})();for(p=u=n+1,l=e.length;u<l;p=u+=1)if(e[p].length>1)return void a(t.convertJumpSpeed,function(){c(n+1,0)})();r&&r()},a(t.convertJumpSpeed,function(){c(0,1)})()},r=function(e,n,t){n.find(">."+e.inputClassName).removeClass(e.typingClassName+" "+e.convertClassName),t&&t()},t=function(e,i,s,u,l){var c,f;i.inputs[e]?(f=function(){r(i,c,u),a(i.typeStartSpeed,function(){t(e+1,i,s,u,l)})()},c=n(i,"base").insertBefore(s),Array.isArray(i.inputs[e][0])?p("typing",i.inputs[e][0],i,c,u,function(){i.inputs[e][1]?o(i.inputs[e][1],i,c,u,a(i.convertJumpSpeed,f)):f()}):p("input",i.inputs[e],i,c,u,f)):l&&l()},s=function(e,n,t,i){var s,r,o;s=e[0],o=function(e,i){var s;3===e.nodeType?(s=function(r){r>=0?a(n.removeSpeed,function(){e.nodeValue=e.nodeValue.slice(0,r),t&&t(),s(r-1)})():(e.parentNode.removeChild(e),t&&t(),i&&i())})(e.nodeValue.length-1):o(e.lastChild,function(){e.lastChild||e.parentNode.removeChild(e),t&&t(),i&&i()})},(r=function(){s.previousSibling?o(s.previousSibling,r):i&&i()})()},i=function(){var n,t,a,i,s,r,o,p,u,l,c,f;for(t=arguments[0],f=2<=arguments.length?slice.call(arguments,1):[],u={},s=0,r=t.length;s<r;s++){if(n=t[s],e.isPlainObject(n)){e.extend(u,n);break}for(a=p=0,o=f.length;p<o;a=++p)if(l=f[a],i=l[0],c=l[1],e.isFunction(c)&&c(n)||typeof n===c){u[i]=n,f.splice(a,1);break}}return u},e.fn.jatyping=function(){var r;return r=e.extend({},e.fn.jatyping.defaults,i(arguments,["inputs",Array.isArray],["complete",e.isFunction],["completeDelay","number"])),e.fn.jatyping.assertOptions(r),this.each(function(){var i,o,p,u;p=this,r.complete&&(o=a(r.completeDelay,r.complete,p)),r.update&&(u=function(){r.update.call(p)}),(i=e(this).find(">."+r.caretClassName)).length||(i=n(r,"caret").appendTo(this)),r.inputs?t(0,r,i,u,o):s(i,r,u,o)})},e.fn.jatyping.assertOptions=function(e){var n,t,a;t=this.defaults;for(n in t)if(!(a=t[n])||/[^a-z0-9_-]/i.test(a))throw new Error("invalid options."+n+": "+a)},e.fn.jatyping.defaults={baseTagName:"span",baseClassName:"jatyping",caretTagName:"span",caretClassName:"jatyping-caret",inputTagName:"span",inputClassName:"jatyping-input",typingClassName:"jatyping-typing",convertClassName:"jatyping-convert",removeSpeed:25,typeSpeed:80,typeStartSpeed:150,convertSpeed:150,convertJumpSpeed:200}}(jQuery);