var Node,expandMoreUnary,expandUnary,finder,generateBinary,generateExpr,generateUnary,pp,time,slice=[].slice;pp=function(){var t;t=1<=arguments.length?slice.call(arguments,0):[],self.postMessage({type:"debug",value:t})},time=function(t){var e;return e=Date.now(),t(),Date.now()-e},Node=function(){function t(t,e,n,i){this.type=t,this.value=e,this.left=n,this.right=i}return t.prototype.clone=function(){return new t(this.type,this.value,this.left,this.right)},t.prototype.minusable=function(){return"minus"!==this.type&&0!==this.value},t.prototype.minus=function(){switch(this.type){case"minus":return this.left.clone();case"add":return this.left.minus()[this.type](this.right.minus());case"mul":case"div":return this.left.minus()[this.type](this.right);default:return new t("minus",-this.value,this.clone())}},t.prototype.hasMinus=function(){switch(this.type){case"minus":return!0;case"add":return this.left.hasMinus()&&this.right.hasMinus();case"mul":case"div":return this.left.hasMinus()||this.right.hasMinus();default:return!1}},t.prototype.sqrtable=function(){return this.value>0&&isFinite(this.value)&&1!==this.value},t.prototype.sqrt=function(){return new t("sqrt",Math.sqrt(this.value),this.clone())},t.prototype.factable=function(){return this.value>=0&&isFinite(this.value)&&Math.round(this.value)===this.value&&1!==this.value},t.prototype.fact=function(){var e,n,i,r;for(r=1,e=n=1,i=this.value;n<=i&&isFinite(r);e=n+=1)r*=e;return new t("fact",r,this.clone())},t.prototype.calcable=function(t){return isFinite(this.value)===isFinite(t.value)},t.prototype.add=function(e){return"minus"===this.type&&this.value===-e.value?this.minus().sub(e):"minus"===e.type?this.sub(e.minus()):new t("add",this.value+e.value,this.clone(),e.clone())},t.prototype.sub=function(e){var n;for(n=this;n.value===e.value&&n.type===e.type&&"number"!==n.type&&!n.right;)n=n.left,e=e.left;return new t("add",n.value-e.value,n.clone(),e.minus())},t.prototype.mul=function(e){var n;return n=e.hasMinus()?"minus":"clone",new t("mul",this.value*e.value,this[n](),e[n]())},t.prototype.div=function(e){var n,i;for(i=this;i.value===e.value&&i.type===e.type&&"number"!==i.type&&!i.right;)i=i.left,e=e.left;return n=e.hasMinus()?"minus":"clone",new t("div",i.value/e.value,i[n](),e[n]())},t.prototype.pow=function(e){return new t("pow",Math.pow(this.value,e.value),this.clone(),e.clone())},t.prototype.toString=function(t){var e,n,i;switch(null==t&&(t=""),this.type){case"number":return this.value.toString();case"minus":e="-"+this.left.toString("-");break;case"sqrt":e="âˆš"+this.left.toString("@");break;case"fact":e=this.left.toString("@")+"!";break;case"add":if(i=this.right.toString("+"),n="-"===i[0]?"":"+",e=""+this.left.toString("+")+n+i,""!==t&&"+"!==t)return"("+e+")";break;case"mul":case"div":if(n="mul"===this.type?"*":"/",e=""+this.left.toString(n)+n+this.right.toString(n),"/"===n&&"/"===t)return"("+e+")";break;case"pow":e=this.left.toString("@")+"^"+this.right.toString("@");break;default:new Error("not support: "+this.type)}return"@"===t?"("+e+")":e},t}(),expandMoreUnary=function(t,e){t.sqrtable()&&e(t.sqrt()),t.factable()&&e(t.fact())},expandUnary=function(t,e,n){e.minusable()&&n(e.minus()),t>0&&expandMoreUnary(e,function(e){n(e),expandUnary(t-1,e,n)})},generateUnary=function(t,e,n){n(e),expandUnary(t,e,n)},generateBinary=function(t,e,n,i){generateExpr(t,e,function(e){generateExpr(t,n,function(n){e.calcable(n)&&(i(e.add(n)),i(e.sub(n)),i(e.mul(n)),i(e.div(n)),t>0&&i(e.pow(n)))})})},generateExpr=function(t,e,n){var i,r,s;switch(e.length){case 0:throw new Error;case 1:generateUnary(t,e[0],n);break;default:for(i=r=1,s=e.length;r<s;i=r+=1)generateBinary(t,e.slice(0,i),e.slice(i,+e.length+1||9e9),function(e){generateUnary(t,e,n)})}},finder=function(t,e,n,i){var r;return r=!1,generateExpr(n,e.map(function(t){return new Node("number",t)}),function(e){t===e.value&&(r=!0,i(e))}),r},self.addEventListener("message",function(t){pp(time(function(){var e,n,i;for(e=function(t){self.postMessage({type:"result",value:t.toString()})},n=i=0;i<=3&&!finder(t.data.answer,t.data.numbers,n,e);n=++i);})),self.postMessage({type:"finish"})},!1);