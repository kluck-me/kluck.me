var Node,expandMoreUnary,expandUnary,generate,generateBinary,generateExpr,generateUnary,pp,slice=[].slice;pp=function(){var t;t=1<=arguments.length?slice.call(arguments,0):[],self.postMessage({type:"debug",value:t})},Node=function(){function t(t,e,n,r){this.type=t,this.value=e,this.left=n,this.right=r}return t.prototype.clone=function(){return new t(this.type,this.value,this.left,this.right)},t.prototype.minus=function(){switch(this.type){case"minus":return this.left.clone();case"add":return this.left.minus()[this.type](this.right.minus());case"mul":case"div":return this.left.minus()[this.type](this.right);default:return new t("minus",-this.value,this.clone())}},t.prototype.hasMinus=function(){switch(this.type){case"minus":return!0;case"add":return this.left.hasMinus()&&this.right.hasMinus();case"mul":case"div":return this.left.hasMinus()||this.right.hasMinus();default:return!1}},t.prototype.sqrt=function(){return new t("sqrt",Math.sqrt(this.value),this.clone())},t.prototype.fact=function(){var e,n,r,i;for(i=1,e=n=1,r=this.value;n<=r&&isFinite(i);e=n+=1)i*=e;return new t("fact",i,this.clone())},t.prototype.add=function(e){return new t("add",this.value+e.value,this.clone(),e.clone())},t.prototype.sub=function(e){return new t("add",this.value-e.value,this.clone(),e.minus())},t.prototype.mul=function(e){var n;return n=e.hasMinus()?"minus":"clone",new t("mul",this.value*e.value,this[n](),e[n]())},t.prototype.div=function(e){var n;return n=e.hasMinus()?"minus":"clone",new t("div",this.value/e.value,this[n](),e[n]())},t.prototype.pow=function(e){return new t("pow",Math.pow(this.value,e.value),this.clone(),e.clone())},t.prototype.toString=function(t){var e,n,r;switch(null==t&&(t=""),this.type){case"self":return this.value.toString();case"minus":e="-"+this.left.toString("-");break;case"sqrt":e="âˆš"+this.left.toString("@");break;case"fact":e=this.left.toString("@")+"!";break;case"add":if(r=this.right.toString("+"),n="-"===r[0]?"":"+",e=""+this.left.toString("+")+n+r,""!==t&&"+"!==t)return"("+e+")";break;case"mul":case"div":if(n="mul"===this.type?"*":"/",e=""+this.left.toString(n)+n+this.right.toString(n),"/"===n&&"/"===t)return"("+e+")";break;case"pow":e=this.left.toString("@")+"^"+this.right.toString("@");break;default:new Error("not support: "+this.type)}return"@"===t?"("+e+")":e},t}(),expandMoreUnary=function(t,e){t.value>0&&e(t.sqrt()),t.value>=0&&Math.round(t.value)===t.value&&e(t.fact())},expandUnary=function(t,e,n){null==n&&(n=0),"minus"!==t.type&&e(t.minus()),n&&expandMoreUnary(t,function(r){e(r),expandUnary(t,e,n-1)})},generateUnary=function(t,e,n){var r,i,s,a;for(r=[],expandUnary(t,function(t){return r.push(t)},n),r.unshift(t),s=0,a=r.length;s<a;s++)i=r[s],e(i)},generateBinary=function(t,e,n,r){generate(t,function(t){generate(e,function(e){n(t.add(e)),n(t.sub(e)),n(t.mul(e)),n(t.div(e)),r>0&&n(t.pow(e))},r)},r)},generate=function(t,e,n){var r,i,s;switch(t.length){case 0:throw new Error;case 1:generateUnary(t[0],e,n);break;default:for(r=i=1,s=t.length;i<s;r=i+=1)generateBinary(t.slice(0,r),t.slice(r,+t.length+1||9e9),function(t){generateUnary(t,e,n)},n)}},generateExpr=function(t,e,n,r){var i;return i=!1,generate(e.map(function(t){return new Node("self",t)}),function(e){pp(e.value,e.toString()),t===e.value&&(i=!0,r(e))},n),i},self.addEventListener("message",function(t){var e;e=generateExpr(t.data.answer,t.data.numbers,0,function(t){self.postMessage({type:"result",value:t.toString()})}),e||generateExpr(t.data.answer,t.data.numbers,1,function(t){self.postMessage({type:"result",value:t.toString()})}),self.postMessage({type:"finish"})},!1);