var $button,$input,$pre,Solver,cache,calc_exprs_score,exprs,solver,updateView;Solver=function(){function e(){this.callbacks=[]}return e.prototype.onMessage=function(e){this.callbacks.push(e)},e.prototype.parseNumbers=function(e){var r;return r=e.match(/[+-]?\d+/g),this.numbers=r?r.filter(function(e){return 1===e.length}).map(function(e){return parseInt(e,10)}):[],this.runnable=4===this.numbers.length,this},e.prototype.stop=function(){var e;return null!=(e=this.worker)&&e.terminate(),this.worker=null,this},e.prototype.run=function(){var e,r,t,n;if(this.runnable&&!this.worker){for(this.worker=new Worker("solver.js"),r=0,t=(n=this.callbacks).length;r<t;r++)e=n[r],this.worker.addEventListener("message",e,!1);this.worker.postMessage({numbers:this.numbers,answer:10})}return this},e}(),$pre=$("pre"),$input=$('form input[name="numbers"]'),$button=$("form button"),cache=null,exprs=null,calc_exprs_score=function(e){var r,t,n,s,o;for(s=0,o={"+":1,"-":1,"*":2,"/":2,"^":10,"√":11,"!":12},r=0,t=(n=e.replace(/[\d()]+/g,"")).length;r<t;r++)s+=o[n[r]]||20;return 100*s+e.length},(solver=new Solver).onMessage(function(e){var r;switch(e.data.type){case"result":r=e.data.value,cache[r]||(cache[r]=calc_exprs_score(r),exprs.push(r),exprs.sort(function(e,r){return cache[e]-cache[r]}),$pre.text(exprs.join("\n")));break;case"finish":solver.stop();break;case"debug":console.log.apply(console,e.data.value)}updateView()}),updateView=function(){solver.worker?($button.text("とめる"),$input.prop("disabled",!0)):($button.text("さがす").prop("disabled",!solver.parseNumbers($input.val()).runnable),$input.prop("disabled",!1))},$("form").submit(function(){return solver.worker?solver.stop():(solver.parseNumbers($input.val()),solver.runnable&&(cache={},exprs=[],$pre.empty(),solver.run())),updateView(),!1}),$input.on("input",updateView),"localhost"===location.hostname&&($input.val("5,0,2,6").trigger("input"),$("form").submit());