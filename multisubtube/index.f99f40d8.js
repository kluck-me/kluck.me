var binarySearch=function(t,e,n){for(var a=0,r=t.length-1;a<=r;){var i=r+a>>1,o=n(e,t[i]);if(o>0)a=i+1;else{if(!(o<0))return i;r=i-1}}return-a-1},fetchLangs=function(t){return new Promise((function(e,n){t?$.get({url:"//video.google.com/timedtext",data:{type:"list",v:t},dataType:"xml"}).then((function(n){var a={};$("transcript_list>track",n).each((function(){var e=$(this),n=e.attr("lang_code");a[n]={label:e.attr("lang_original"),params:{name:e.attr("name"),lang:n,v:t}}})),e(a)}),n):n()}))},getSubs=function(t,e){var n={};return e.forEach((function(e){var a=t[e];if(a){var r=n[e]=[];$.get({url:"//video.google.com/timedtext",data:a.params,dataType:"xml"}).done((function(t){$("transcript>text",t).each((function(){var t=$(this),e=parseFloat(t.attr("start")),n=parseFloat(t.attr("dur"));r.push({start:e,end:e+n,text:t.text()})}))}))}})),n};window.vm=new Vue({el:"#vue",data:{videoId:null,texts:[],subs:null,langs:null,selectedCodes:{},url:""},computed:{codes:function(){var t=this;return Object.keys(this.selectedCodes).filter((function(e){return t.selectedCodes[e]})).sort()}},watch:{url:function(t){this.fetchLangs(__guard__(/v=([^=&?]+)/.exec(t),(function(t){return t[1]})))}},methods:{play:function(){$("#modal-conf").modal("hide"),this.videoId&&player.getVideoData().video_id!==this.videoId&&player.loadVideoById(this.videoId)},fetchLangs:function(t){var e=this;return this.videoId=t,this.langs=null,fetchLangs(t).then((function(t){e.langs=t}))},fetchSubs:function(t){if(!this.langs||this.videoId!==t)return this.subs=null,void this.fetchLangs(t);this.subs||(this.subs=getSubs(this.langs,this.codes))},updateSubs:function(t){var e=this;this.texts=this.codes.map((function(n){if(e.subs){var a=e.subs[n];if(null!=t&&a){var r=binarySearch(a,t,(function(t,e){return t>e.end?1:t<e.start?-1:0}));if(r>=0)return a[r].text}}}))}}});var updateCurrentTime=function(){window.vm.updateSubs(__guardMethod__(player,"getCurrentTime",(function(t){return t.getCurrentTime()}))),requestAnimationFrame(updateCurrentTime)};updateCurrentTime();var onPlayerReady=function(t){t.target;if($("#modal-conf").modal("show"),"localhost"===location.hostname){var e=function(t){return setTimeout(t,500)};e((function(){return window.vm.$data.url="https://www.youtube.com/watch?v=WqUBWz3YR7s",e((function(){return window.vm.$data.selectedCodes={en:!0,"zh-TW":!0},window.vm.$data.url="https://www.youtube.com/watch?v=4cQ4ZQn-KRA",e((function(){return $("#modal-conf .btn-primary").click()}))}))}))}},onPlayerStateChange=function(t){var e=t.target;window.vm.fetchSubs(e.getVideoData().video_id)};function __guard__(t,e){return null!=t?e(t):void 0}function __guardMethod__(t,e,n){return null!=t&&"function"==typeof t[e]?n(t,e):void 0}window.onYouTubeIframeAPIReady=function(){window.player=new YT.Player("ytplayer",{height:"480",width:"853",events:{onReady:onPlayerReady,onStateChange:onPlayerStateChange}})};