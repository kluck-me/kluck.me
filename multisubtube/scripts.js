var Video,confVideo,getConfLangCodes,onPlayerReady,onPlayerStateChange,renderSubs,setConfLangCodes,setConfVideoUrl,video,slice=[].slice;Video=function(){function e(){this.id=null,this.subs=null,this.langs=null,this.langCodes=[]}var n;return n=function(e,n,t){var o,a,i,s;for(i=0,s=e.length-1;i<=s;)if(a=s+i>>1,(o=t(n,e[a]))>0)i=a+1;else{if(!(o<0))return a;s=a-1}return-i-1},e.prototype.update=function(e){return this.id!==e&&(this.id=e,this.subs=null,this.langs=null,!0)},e.prototype.setLangCodes=function(){var e;e=1<=arguments.length?slice.call(arguments,0):[],this.langCodes=e},e.prototype.hasLangCode=function(e){return this.langCodes.indexOf(e)>-1},e.prototype.addLangCode=function(e){this.hasLangCode(e)||(this.langCodes=this.langCodes.concat([e]).sort())},e.prototype.removeLangCode=function(e){var n;(n=this.langCodes.indexOf(e))>-1&&(this.langCodes=this.langCodes.concat().splice(n,1))},e.prototype.getCurrentHtmls=function(e){var t;return t=this,this.langCodes.map(function(o){var a,i;return t.subs&&(a=t.subs[o],null!=e&&a&&(i=n(a,e,function(e,n){return e>n.end?1:e<n.start?-1:0}))>=0)?a[i].text:null})},e.prototype.fetchSubs=function(){var e;this.langs?(e=this,this.subs||(this.subs={}),this.langCodes.forEach(function(n){var t,o;(t=e.langs[n])&&(e.subs[n]||(o=e.subs[n]=[],$.get({url:"//video.google.com/timedtext",data:t.params,dataType:"xml"}).done(function(e){$("transcript>text",e).each(function(){var e,n,t;e=$(this),t=parseFloat(e.attr("start")),n=parseFloat(e.attr("dur")),o.push({start:t,end:t+n,text:e.text()})})})))})):this.fetchLangs(function(){this.fetchSubs()})},e.prototype.fetchLangs=function(e){var n;this.langs||this.id&&(n=this,this.langs={},$.get({url:"//video.google.com/timedtext",data:{type:"list",v:this.id},dataType:"xml"}).done(function(t){$("transcript_list>track",t).each(function(){var e,t;t=(e=$(this)).attr("lang_code"),n.langs[t]={label:e.attr("lang_original"),params:{name:e.attr("name"),lang:t,v:n.id}}}),e.call(n)}))},e}(),video=new Video,(renderSubs=function(){var e;(e=$("#subs>div")).length!==video.langCodes.length&&(e.remove(),video.langCodes.forEach(function(e,n){return $("<div>").attr("id","sub-"+n).appendTo("#subs")})),video.getCurrentHtmls("undefined"!=typeof player&&null!==player&&"function"==typeof player.getCurrentTime?player.getCurrentTime():void 0).forEach(function(e,n){$("#sub-"+n).html(e||"&nbsp;")}),requestAnimationFrame(renderSubs)})(),confVideo=null,getConfLangCodes=function(){var e;return e=[],$('#conf-subs input[name^="lang-"]:checked').each(function(){e.push($(this).val())}),e},setConfVideoUrl=function(e){$("#conf-url").val(e||"").trigger("input")},setConfLangCodes=function(){var e;e=1<=arguments.length?slice.call(arguments,0):[],$('#conf-subs input[name^="lang-"]').prop("checked",!1).trigger("change"),e.forEach(function(e){$('#conf-subs input[name="lang-'+e+'"]').prop("checked",!0).trigger("change")})},$("#conf-url").on("input",function(){var e,n;n=null!=(e=/v=([^=&?]+)/.exec($(this).val()))?e[1]:void 0,confVideo.update(n),confVideo.fetchLangs(function(){confVideo.setLangCodes.apply(confVideo,getConfLangCodes()),$("#conf-subs").empty(),Object.keys(confVideo.langs).sort().forEach(function(e){var n;n=$("<div>").addClass("checkbox"),$("<label>").append($("<input>").attr({type:"checkbox",name:"lang-"+e,value:e}).prop("checked",confVideo.hasLangCode(e)).change(function(){var e;e=$(this),confVideo[$(this).prop("checked")?"addLangCode":"removeLangCode"](e.val())}),document.createTextNode(confVideo.langs[e].label)).appendTo(n),n.appendTo("#conf-subs")})})}),$("#modal-conf form").submit(function(e){e.preventDefault(),e.stopPropagation(),$("#modal-conf").modal("hide"),video=confVideo,confVideo=null,player.getVideoData().video_id!==video.id&&player.loadVideoById(video.id)}),$("#modal-conf").on("show.bs.modal",function(){confVideo?confVideo.langCodes:video.langCodes,(confVideo=new Video).setLangCodes.apply(confVideo,video.langCodes),setConfVideoUrl("undefined"!=typeof player&&null!==player?player.getVideoUrl():void 0)}),onPlayerReady=function(e){var n;e.target,$("#modal-conf").modal("show"),"localhost"===location.hostname&&(n=function(e){return setTimeout(e,500)})(function(){return setConfVideoUrl("https://www.youtube.com/watch?v=sLv6FfHlxmI"),n(function(){return setConfLangCodes("en","ja"),setConfVideoUrl("https://www.youtube.com/watch?v=-sGiE10zNQM"),n(function(){return $("#modal-conf .btn-primary").click()})})})},onPlayerStateChange=function(e){var n;n=e.target,video.update(n.getVideoData().video_id),video.fetchSubs()},window.onYouTubeIframeAPIReady=function(){window.player=new YT.Player("ytplayer",{height:"480",width:"853",events:{onReady:onPlayerReady,onStateChange:onPlayerStateChange}})};